<!DOCTYPE html> <!-- DeclaraciÃ³n del tipo de documento HTML5 -->
<html> <!-- Etiqueta raÃ­z del documento HTML -->
  <head>  <!-- SecciÃ³n de metadatos y recursos del documento -->
    <link rel="manifest" href="manifest.json" />
    <meta name="theme-color" content="#007bff">

  <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mi App</title>
    <link rel="stylesheet" href="style.css" />
    <base target="_top"> <!-- Establece que todos los links se abran en la ventana superior (importante para Apps Script) -->

    <style> /*Inicio de la seccion CSS  ðŸ…±ðŸ…°ðŸ†Ž*/

/*BOTON MODO OBSCURO ðŸŽ¨ðŸŽ¨ðŸŽ¨*/

      body {
  background-color: #ffffff;
  color: #222;
  transition: background-color 0.4s, color 0.4s;
}

/* Modo oscuro general */
body.dark-mode {
  background-color: #121212;
  color: #f1f1f1;
}

/* Cajas internas */
.formulario,
.resultado-box {
  transition: background-color 0.4s, color 0.4s;
}

/* En modo claro */
body:not(.dark-mode) .formulario,
body:not(.dark-mode) .resultado-box {
  background-color: #f9f9f9;
  color: #222;
}

/*INPUTS  DEL MODO OBSCURO MAS SUAVES*/

input, select {
  background-color: #fff;
  color: #222;
  border: 1px solid #ccc;
  transition: background-color 0.4s, color 0.4s, border-color 0.4s;
}

/* En modo oscuro */
body.dark-mode input,
body.dark-mode select {
  background-color: #1f1f1f;
  color: #eee;
  border: 1px solid #555;
}

/* En modo oscuro */
body.dark-mode .formulario,
body.dark-mode .resultado-box {
  background-color: #1e1e1e;
  color: #eee;
}

/* BotÃ³n modo oscuro */
.boton-darkmode {
  position: fixed;
  top: 10px;
  right: 10px;
  padding: 8px 14px;
  background-color: #333;
  color: #fff;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  z-index: 1000;
}

/*PESTAÃ‘A AMPUTACIONES EN MODO OBSCURO CUANDO SE PINTA DE CELESTE CADA PORCION DEL CUERPO */

.checkbox-container label:hover {
  background-color: #e0f7fa;
  color: #000;
  cursor: pointer;
  border-radius: 6px;
  padding: 4px;
}

/* En modo oscuro */
body.dark-mode .checkbox-container label:hover {
  background-color: #2c3e50;  /* azul oscuro */
  color: #fff;
}



/*GENERALIDADES DE LA PAGINA*/

      body {
        font-family: Arial, sans-serif;
        margin: 0 auto;
        padding: 20px;
        max-width: 1200px;  /* Ahora tu app puede ocupar hasta 1200px en pantallas grandes */
    }
  /* Fuente principal del documento - Ancho maximo - centra el contenido horizontalmente */
      label { font-weight: bold; display: block; margin-top: 10px; } /* BOLD:Texto en negrita, y cada label ocupa una linea- espacio superior */
      input, select { width: 100%; padding: 8px; } /* Ocupa todo el ancho disponible - Espacio Interno */
      .resultado { margin-top: 20px; background: #eef; padding: 10px; border-radius: 8px; } /* Color de fondo azul claro - espacio initerno- bordes redondeados */
      .loader {  /* Estilo para el elemento de carga (spinner) */
          border: 4px solid #f3f3f3; /* Borde gris claro */
          border-top: 4px solid #4285f4;
          border-radius: 50%;
          width: 30px;
          height: 30px;
          animation: spin 1s linear infinite;
          margin: 20px auto;
          display: none; /* Oculto por defecto */
        }
        @keyframes spin {  /* Define la animaciÃ³n de rotaciÃ³n */
          0% { transform: rotate(0deg); } /* Inicio: 0 grados */
          100% { transform: rotate(360deg); } /* Fin: 360 grados (rotaciÃ³n completa) */
        }
    /* ESTILOS PESTAÃ‘AS */
      .tab {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        padding: 10px 0;
        background: none;      /* Elimina fondo */
        border: none;          /* Elimina bordes */
        box-shadow: none;      /* Por si hay sombra oculta */
}

      .tab button {
          background-color: #f0f0f0;
          color: #333;
          border: 1px solid #ccc;
          border-radius: 10px;
          padding: 10px 18px;
          font-size: 15px;
          font-weight: bold;
          cursor: pointer;
          box-shadow: 2px 2px 6px rgba(0, 0, 0, 0.1); /* sombra individual */
          transition: all 0.3s ease;
        }
    /*ESTADOS ESPECIALES DE LOS BOTONES DE LAS PESTAÃ‘AS ðŸŽ®ðŸŽ®*/
      .tab button:hover {/*color al pasar el cursor*/
         background-color: #34495e;       /* Un poco mÃ¡s claro al pasar el mouse */
         color: white;
         transform: scale(1.03);
      }
      .tab button.active {
        background-color: #4285f4;       /* Azul Google para el activo */
        color: white;
        border: none;
        box-shadow: 2px 2px 6px rgba(66, 133, 244, 0.4); /* sombra azul clara */

      }
      .tabcontent {
        display: none;
      }
      .tabcontent.default {
        display: block;
      }
      /*BOTONES CALCULAR*/

      .boton-calculo {
        background-color: #4CAF50;
        color: white;
        padding: 10px 16px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
        font-weight: bold;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        transition: background-color 0.3s, transform 0.2s;
      }

.boton-calculo:hover {
  background-color: #388e3c;
  transform: scale(1.03);
}
/* ESTILO VISUAL DE CHECKBOX âœ…âœ…âœ…*/

.checkbox-container {
  display: flex;
  flex-direction: column; /* ordena las filas en columnas */
  gap: 8px; /* Espacio vertical entre cada fila */
  margin-bottom: 15px;
}

.checkbox-container label {
  display: flex;
  align-items: center; /* âœ… Alinea verticalmente el checkbox y el texto */
  gap: 8px;             /* âœ… Espacio entre el checkbox y el texto */
  margin-bottom: 8px;   /* âœ… Espaciado uniforme entre cada fila */
  cursor: pointer;
  position: relative;
}


.checkbox-container label:hover {
  background-color: #e0f7fa; /* Color suave al pasar el mouse */
}

.checkbox-container input[type="checkbox"] {
  width: 18px;
  height: 18px;
  accent-color: #4285f4; /* Color azul Google cuando estÃ¡ tildado */
}

.checkbox-container label {
  position: relative;
  display: inline-block;
  margin-bottom: 10px;
  cursor: pointer;
  
}
.checkbox-container label:hover::after { /*::after agrefa un artel flotante cuando pasas el mouse*/
  content: attr(data-tooltip); /*ATRIBUTO data-tooltip: en cada checkbox con el texto a mostrar*/
  position:absolute;
  left: 25px;
  top: -5px;
  background-color: #333;
  color: #fff;
  padding: 4px 8px;
  font-size: 12px;
  border-radius: 4px;
  white-space: nowrap;
  z-index: 10;
}
/*TEXTO DEL TOOLTIP automÃ¡tico usando data-tooltip */
.checkbox-container label { /*aplica los estilos a cada label (texto al lado de cada checkbox) que esta dentro del contenedor con clase checbok-container*/
  position: relative; /*DICE: este label va a servir de referencia para colocar cosas encima*/
  cursor: pointer; /*cursor se transforma en manito*/
}

/* Tooltip general */
label[data-tooltip] {
  position: relative;
  cursor: pointer;
}

label[data-tooltip]::after {
  content: attr(data-tooltip);
  position: absolute;
  bottom: 125%; /* Se muestra arriba del label */
  left: 50%;
  transform: translateX(-50%);
  background-color: #222;
  color: #f1f1f1;
  padding: 6px 10px;
  font-size: 0.8em;
  border-radius: 6px;
  white-space: nowrap;
  opacity: 0;
  visibility: hidden;
  transition: opacity 0.3s ease;
  box-shadow: 0 2px 8px rgba(0,0,0,0.3);
  z-index: 10;
  pointer-events: none;
}

label[data-tooltip]:hover::after {
  opacity: 1;
  visibility: visible;
}

/* Si estÃ¡s en modo claro, que sea gris claro */
body:not(.dark-mode) label[data-tooltip]::after {
  background-color: #eee;
  color: #000;
}


/* CONTENEDOR GENERAL FLEXIBLE */
.contenedor-flex {
  display: flex;
  flex-wrap: wrap;
  gap: 20px;
  justify-content: space-between;
}

/* CADA COLUMNA: formulario y resultado */
.formulario, .resultado-box {
  flex: 1 1 320px;              /* MÃ­nimo 320px, se adaptan al espacio */
  padding: 20px;
  background: #f9f9f9;          /* ðŸŽ¨ Fondo claro */
  color: #222;                  /* ðŸ–‹ Texto gris oscuro */
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); /* Sombra mÃ¡s suave */
  box-sizing: border-box;
}

/* Estilo responsivo para celulares */
@media (max-width: 600px) {
  .contenedor-flex {
    flex-direction: column;
  }
}


    </style>
  </head>
  <body>
     <div class="tab">
      <button class="tablinks active" onclick="openTab(event, 'Calculadora')">Requerimientos</button>
      <button class="tablinks" onclick="openTab(event, 'Info')">Estimacion Peso - Talla</button>
      <button class="tablinks" onclick="openTab(event, 'Amputacion')">Peso Ajustado (AmputaciÃ³n)</button>
      <button class="tablinks" onclick="openTab(event, 'PI')">PI y PIC</button>

    </div>
<!--BONTON MODO OBSCURO  ðŸŽ¨ðŸŽ¨ðŸŽ¨-->

<button onclick="toggleDarkMode()" class="boton-darkmode">ðŸŒ“ Modo Oscuro</button>

<!--  PESTAÃ‘A 1 REQUERIMEINTOS ðŸ“ðŸ“ðŸ“ -->
 
  <div id="Calculadora" class="tabcontent default" style="display: block;">
  <div class="contenedor-flex">
    
    <!-- FORMULARIO A LA IZQUIERDA -->
    <div class="formulario">
      <h2>CÃ¡lculo de Requerimientos</h2>

      <label>Sexo:</label>
      <select id="sexo">
        <option value="Femenino">Femenino</option>
        <option value="Masculino">Masculino</option>
      </select>

      <label>Edad (aÃ±os):</label>
      <input type="number" id="edad">

      <label>Peso (kg):</label>
      <input type="number" id="peso">

      <label>Talla (cm):</label>
      <input type="number" id="talla">

      <label>Factor PatologÃ­a:</label>
      <input type="number" step="0.01" id="factorPatologia" value="1.0">

      <label>Factor Actividad:</label>
      <input type="number" step="0.01" id="factorActividad" value="1.0">

      <button class="boton-calculo" onclick="calcular()">Calcular</button>
    </div>

     <!-- Columna derecha: Resultado -->
      <div class="resultado-box" id="resultado" style="display:none;">
    <h3>Resultado</h3>
    <!-- el contenido aparecerÃ¡ aquÃ­ -->
</div>

  </div>
  </div>

<!-- PESTAÃ‘A 2 - ESTIMACIONES ðŸ“ŒðŸ“ŒðŸ“Œ -->
  <div id="Info" class="tabcontent">
    <div class="contenedor-flex">
      
    <!-- FORMULARIO: EstimaciÃ³n de Talla -->
    <div class="formulario">
      <h2>EstimaciÃ³n de Talla</h2>
      
      <label for="ar-talla">Altura de rodilla (cm):</label>
      <input type="number" id="ar-talla">

      <label for="edad-talla">Edad:</label>
      <input type="number" id="edad-talla">

      <label for="sexo-talla">Sexo:</label>
      <select id="sexo-talla">
        <option value="masculino">Masculino</option>
        <option value="femenino">Femenino</option>
      </select>

      <button onclick="calcularTalla()" class="boton-calculo">Calcular Talla</button>
    </div>

    <!-- RESULTADO -->
    <div class="resultado-box" id="resultado-talla" style="display: none;">
      <h3>Resultado</h3>
      <p><strong>Talla estimada:</strong> <span id="valor-talla">0</span> cm</p>
      <p style="font-size: 0.9em; color: #666;">Margen de error: Â±7-9 cm</p>
    </div>

    </div>
    
    <!-- FORMULARIO: EstimaciÃ³n de Peso -->
 
    <div class="contenedor-flex">

      <!-- Lado Izquierdo -->

      <div class="formulario">
        <h2>EstimaciÃ³n de Peso</h2>

        <label for="ar-peso">Altura de rodilla (cm):</label>
        <input type="number" id="ar-peso">

        <label for="cmb">Circunferencia brazo (cm):</label>
        <input type="number" id="cmb">

        <label for="edad-peso">Edad:</label>
        <input type="number" id="edad-peso">

        <label for="sexo-peso">Sexo:</label>
        <select id="sexo-peso">
          <option value="masculino">Masculino</option>
          <option value="femenino">Femenino</option>
        </select>

      <button onclick="calcularPeso()" class="boton-calculo">Calcular Peso</button>
      </div>

<!-- LADO DERECHO âž¡âž¡âž¡ðŸ‘‰ðŸ‘‰-->

    <div class="resultado-box" id="resultado-peso" style="display: none;">
        <h3>Resultado</h3>
        <p><strong>Peso estimado:</strong> <span id="valor-peso">0</span> kg</p>
        <p style="font-size: 0.9em; color: #666;">Margen de error: Â±3-5 kg</p>
    </div>  
  </div>
    </div>
<!--- PESO AJUSTADO PARA AMPUTACIONES ðŸ“ŒðŸ“ŒðŸ“Œ--->

  <div id="Amputacion" class="tabcontent" style="display: none;">
    <div class="contenedor-flex">

      <!---FORMULARIO-->

      <div class="formulario">
        <h2>Peso Ajustado por AmputaciÃ³n</h2>

        <label for="peso-amputado">Peso medido (kg):</label>
        <input type="number" id="peso-amputado">

    <label>Segmentos amputados:</label>
    <div class="checkbox-container">
      <label data-tooltip="0.8% del peso corporal"><input type="checkbox" value="0.8"> Mano</label>
      <label data-tooltip="2.3% del peso corporal"><input type="checkbox" value="2.3"> Antebrazo (sin mano)</label>
      <label data-tooltip="6.5% del peso corporal"><input type="checkbox" value="6.5"> Brazo completo</label>
      <label data-tooltip="1.8% del peso corporal"><input type="checkbox" value="1.8"> Pie</label>
      <label data-tooltip="5.3% del peso corporal"><input type="checkbox" value="5.3"> Parte inferior pierna (sin pie)</label>
      <label data-tooltip="11.6% del peso corporal"><input type="checkbox" value="11.6"> Muslo</label>
      <label data-tooltip="18.7% del peso corporal"><input type="checkbox" value="18.7"> Miembro inferior completo</label>
    </div>

    <button onclick="calcularAmputacion()" class="boton-calculo">Calcular Peso Ajustado</button>
      </div>

<!---RESULTADO A LA DERECHA-->

  <div class="resultado-box" id="resultado-amputacion" style="display: none;">
      <h3>Resultado</h3>
      <p><strong>Peso ajustado:</strong> <span id="valor-ajustado">0</span> kg</p>
      <button onclick="copiarResultadoAmputacion()" class="boton-secundario" style="margin-top: 10px;">ðŸ“‹ Copiar Resultado</button>
  </div>
    </div>
  </div>


<!-- PESTAÃ‘A PESO IDEAL Y PESO IDEAL CORREGIDO ðŸ“ŒðŸ“ŒðŸ“Œ-->

  <div id="PI" class="tabcontent" style="display: none;">
    <div class="contenedor-flex">

      <!---FOMRULARIO-->
      <div class="formulario">
        <h2 style="color: #4285f4;">Peso Ideal y PIC</h2>

        <label for="sexo-pi">Sexo:</label>
        <select id="sexo-pi" style="width: 100%; padding: 8px; margin-bottom: 15px;">
          <option value="Femenino">Femenino</option>
          <option value="Masculino">Masculino</option>
        </select>

        <label for="edad-pi">Edad (aÃ±os):</label>
        <input type="number" id="edad-pi">

        <label for="talla-pi">Talla (cm):</label>
        <input type="number" id="talla-pi">

        <label for="peso-actual">Peso actual (kg):</label>
        <input type="number" id="peso-actual">

        <label for="factor-patologia-pi">Factor PatologÃ­a:</label>
        <input type="number" id="factor-patologia-pi" step="0.01" value="1.0">

       <button onclick="calcularPIC()" class="boton-calculo">Calcular PI / PIC / GCT</button>
      </div>
    
  <!--RESULTADOS-->

      <div class="resultado-box" id="resultado-pi" style="display: none;">
        <h3>Resultados</h3>
        <p><strong>Peso Ideal (segun formula de Hamwi):</strong> <span id="valor-pi">0</span> kg</p>
        <p><strong>Peso Ideal Corregido (PIC):</strong> <span id="valor-pic">0</span> kg</p>
        <p><strong>TMB (Harris Benedict calculado con PIC):</strong> <span id="valor-tmb-pic">0</span> kcal/dÃ­a</p>
        <p><strong>Gasto CalÃ³rico Total (GCT):</strong> <span id="valor-gct-pic">0</span> kcal/dÃ­a</p>
        <!--CONTENEDOR PARA LA FORMULA-->
        <div id="formula-pic" style="margin-top:10px; font-size:0.9em; color:#666; border-top:1px solid #eee; padding-top:8px;"></div>
      </div>

    </div>
  </div>


  <!-- FUNCIONES JAVASCRIPT ðŸ”¦ðŸ¹ðŸ¹ðŸ¹ðŸ“Ž -->
  <script>
    function calcularTalla() {
      // Obtener valores comunes
      const ar = parseFloat(document.getElementById('ar-talla').value);
      const edad = parseInt(document.getElementById('edad-talla').value);
      const sexo = document.getElementById('sexo-talla').value;
      
      // ValidaciÃ³n
      if (!ar || !edad) {
        alert('Complete todos los campos');
        return;
      }

      // CÃ¡lculo segÃºn fÃ³rmula de Chumlea
      let talla;
      if (sexo === 'masculino') {
        if (edad >= 19 && edad <= 59) talla = (ar * 1.88) + 71.85;
        else if (edad >= 60 && edad <= 80) talla = (ar * 2.08) + 59.01;
      } else {
        if (edad >= 19 && edad <= 59) talla = (ar * 1.86) - (edad * 0.05) + 70.25;
        else if (edad >= 60 && edad <= 80) talla = (ar * 1.91) - (edad * 0.17) + 75.00;
      }

      // Mostrar resultado
      if (talla) {
        document.getElementById('valor-talla').textContent = talla.toFixed(2);
        document.getElementById('resultado-talla').style.display = 'block';
      } else {
        alert('Edad fuera de rango (19-80 aÃ±os)');
      }
    }

    function calcularPeso() {
      // Obtener valores
      const ar = parseFloat(document.getElementById('ar-peso').value);
      const cmb = parseFloat(document.getElementById('cmb').value);
      const edad = parseInt(document.getElementById('edad-peso').value);
      const sexo = document.getElementById('sexo-peso').value;
      
      // ValidaciÃ³n
      if (!ar || !cmb || !edad) {
        alert('Complete todos los campos');
        return;
      }

      // CÃ¡lculo segÃºn fÃ³rmula de Brunnstrom
      let peso;
      if (sexo === 'masculino') {
        if (edad >= 19 && edad <= 59) peso = (ar * 1.19) + (cmb * 3.21) - 86.82;
        else if (edad >= 60 && edad <= 80) peso = (ar * 1.10) + (cmb * 3.07) - 75.81;
      } else {
        if (edad >= 19 && edad <= 59) peso = (ar * 1.01) + (cmb * 2.81) - 66.04;
        else if (edad >= 60 && edad <= 80) peso = (ar * 1.09) + (cmb * 2.68) - 65.51;
      }

      // Mostrar resultado
      if (peso) {
        document.getElementById('valor-peso').textContent = peso.toFixed(2);
        document.getElementById('resultado-peso').style.display = 'block';
      } else {
        alert('Edad fuera de rango (19-80 aÃ±os)');
      }
    }
//FUNCION AMPUTACIONES ðŸ“ŒðŸ“ŒðŸ“Œ

//BOTON MODO OSCURO ðŸŽ¨ðŸŽ¨
function toggleDarkMode() {
  document.body.classList.toggle("dark-mode");
}

    function calcularAmputacion() {
  const peso = parseFloat(document.getElementById("peso-amputado").value);
  if (isNaN(peso) || peso <= 0) {
    alert("Ingrese un peso vÃ¡lido.");
    return;
  }

// Sumar % de todos los segmentos seleccionados
  const checkboxes = document.querySelectorAll("#Amputacion input[type='checkbox']:checked");
  let porcentajeTotal = 0;
  checkboxes.forEach(cb => {
    porcentajeTotal += parseFloat(cb.value);
  });

  if (porcentajeTotal === 0) {
    alert("Seleccione al menos un segmento amputado.");
    return;
  }

// Aplicar fÃ³rmula
const pesoAjustado = peso * (100 / (100 - porcentajeTotal));

// MOSTRAR LA FORMULA CON LOS REEMPLAZOS DE LOS DATOS INGRESADOS

const formula = `FÃ³rmula: (${peso} Ã— 100) / (100 - ${porcentajeTotal.toFixed(1)}) = ${pesoAjustado.toFixed(2)} kg`;


document.getElementById("resultado-amputacion").innerHTML = `
  <h3 style="margin-top: 0; color: #2e7d32;">Resultado</h3>
  <p><strong>Peso ajustado:</strong> <span id="valor-ajustado">${pesoAjustado.toFixed(2)}</span> kg</p>
  <p style="font-size: 0.9em; color: #666;">${formula}</p>
`;

// Mostrar resultado
  document.getElementById("valor-ajustado").textContent = pesoAjustado.toFixed(2);
  document.getElementById("resultado-amputacion").style.display = "block";
  
}

//BOTON COPIAR AL PORTAPAPELES 
function copiarResultadoAmputacion() {
  const contenido = document.getElementById("resultado-amputacion").innerText;
  navigator.clipboard.writeText(contenido)
}

// FUNCION PI Y PIC ðŸ“ŒðŸ“ŒðŸ“ŒðŸ“Œ


function calcularPIC() { // CREAS LA Fx
  const sexo = document.getElementById("sexo-pi").value; //Obtenes datos de formulario
  const edad = parseFloat(document.getElementById("edad-pi").value); //Toma el valor numÃ©rico ingresado en el input de edad (edad-pi) y lo convierte a nÃºmero decimal (float). y lo guaarda en la variable edad.
  const talla = parseFloat(document.getElementById("talla-pi").value);
  const pesoActual = parseFloat(document.getElementById("peso-actual").value);
  const factorPatologia = parseFloat(document.getElementById("factor-patologia-pi").value);
  const factorActividad = parseFloat(document.getElementById("factor-actividad-pi")?.value) ||1;  //Toma el factor de actividad fÃ­sica. Si por alguna razÃ³n el campo no existe o estÃ¡ vacÃ­o, usa 1 como valor por defecto (sin correcciÃ³  ?. operador de encadenamiento opcional, que evita errores si el elemento no existe.

//VALIDACION DE DATOS: SI FALTA ALGUNO
  if (isNaN(talla) || isNaN(pesoActual) || isNaN(edad)) {
    alert("Complete todos los campos correctamente.");
    return;
  }

  // Calcular Peso Ideal (PI)
  let pi;
  if (sexo === "Femenino") {
    pi = 45.5 + 2.27 * ((talla - 150) / 2.5);
  } else {
    pi = 47.7 + 2.72 * ((talla - 150) / 2.5);
  }

  // Calcular Peso Ideal Corregido (PIC)
  const pic = (pesoActual - pi) * 0.25 + pi;

  // Calcular TMB usando PIC
  let tmb;
  if (sexo === "Femenino") {
    tmb = 655.1 + (9.56 * pic) + (1.85 * talla) - (4.68 * edad);
  } else {
    tmb = 66.47 + (13.75 * pic) + (5 * talla) - (6.76 * edad);
  }

//CALCULAR GCT

  const gct = tmb * factorActividad * factorPatologia;

  // Mostrar resultados
  document.getElementById("valor-pi").textContent = pi.toFixed(2);
  document.getElementById("valor-pic").textContent = pic.toFixed(2);
  document.getElementById("valor-tmb-pic").textContent = tmb.toFixed(0);
  document.getElementById("valor-gct-pic").textContent = gct.toFixed(0);
//Toma los valores calculados y los inserta en los spans del HTML, usando .toFixed() para limitar los decimales: PI y PIC â†’ 2 decimales y TMB y GCT â†’ enteros


  // Mostrar fÃ³rmula
  const formulaText = sexo === "Femenino"
    ? "TMB mujer = 655.1 + (9.56 Ã— peso) + (1.85 Ã— talla) âˆ’ (4.68 Ã— edad)"
    : "TMB varÃ³n = 66.47 + (13.75 Ã— peso) + (5 Ã— talla) âˆ’ (6.76 Ã— edad)";

  document.getElementById("formula-pic").innerHTML = formulaText;

  // Mostrar caja de resultados
  document.getElementById("resultado-pi").style.display = "block";
} //Este bloque estaba oculto (display: none). Con esta lÃ­nea se muestra para que el usuario vea los resultados.

  </script>

  <script>

// FUNCIÃ“N PARA CAMBIAR PESTAÃ‘AS
      function openTab(evt, tabName) {
        // Oculta todos los contenidos
        var tabcontent = document.getElementsByClassName("tabcontent");
        for (var i = 0; i < tabcontent.length; i++) {
          tabcontent[i].style.display = "none";
        }
        
        // Desactiva todos los botones
        var tablinks = document.getElementsByClassName("tablinks");
        for (var i = 0; i < tablinks.length; i++) {
          tablinks[i].className = tablinks[i].className.replace(" active", "");
        }
        
        // Muestra la pestaÃ±a actual
        document.getElementById(tabName).style.display = "block";
        evt.currentTarget.className += " active";
      }
//  CALCULOS DE REQUERIMIENTOS ðŸ“ŒðŸ“ŒðŸ“Œ
      function calcular() {
  console.log("FunciÃ³n ejecutÃ¡ndose"); // Verifica en la consola (F12)


  const datos = {
             sexo: document.getElementById("sexo").value,
          edad: document.getElementById("edad").value,
          peso: document.getElementById("peso").value,
          talla: document.getElementById("talla").value,
          factorPatologia: document.getElementById("factorPatologia").value,
          factorActividad: document.getElementById("factorActividad").value
        };


  google.script.run.withSuccessHandler(function(res) {
          const div = document.getElementById("resultado");
          div.style.display = "block";   
  // âž• Texto explicativo 
    const formulaText = datos.sexo === "Femenino" 
      ? "FÃ³rmula HB (Mujer): 655.1 + (9.56 Ã— peso) + (1.85 Ã— talla) - (4.68 Ã— edad)"
      : "FÃ³rmula HB (Hombre): 66.47 + (13.75 Ã— peso) + (5 Ã— talla) - (6.76 Ã— edad)";
    
    div.innerHTML = `
      <strong>TMB:</strong> ${res.tmb} kcal/dÃ­a<br>
      <strong>GCT:</strong> ${res.gct} kcal/dÃ­a<br>
      <div style="margin-top:10px; font-size:0.9em; color:#666; border-top:1px solid #eee; padding-top:8px;">
        ${formulaText}
      </div>
    `;
  }).calcularTMB(datos);
}
  </script>

  <script>


  // FUNCION CALCULAR PARA REQUERIMIENTOS 
function calcular() {
  const sexo = document.getElementById("sexo").value;
  const edad = parseFloat(document.getElementById("edad").value);
  const peso = parseFloat(document.getElementById("peso").value);
  const talla = parseFloat(document.getElementById("talla").value);
  const factorPatologia = parseFloat(document.getElementById("factorPatologia").value);
  const factorActividad = parseFloat(document.getElementById("factorActividad").value);

  // ðŸ“Œ Calculamos el IMC usando la fÃ³rmula: peso en kg / (talla en metros)Â²
  const imc = peso / Math.pow(talla / 100, 2);

 // ðŸ“Œ Definimos una variable para guardar la categorÃ­a nutricional
  let clasificacionIMC = "";

// ðŸ“Œ Clasificamos el IMC segÃºn OMS adaptado de Canicoba y Mauricio (2017)
  if (imc < 16) {
    clasificacionIMC = "DesnutriciÃ³n Severa";
  } else if (imc >= 16 && imc < 17) {
    clasificacionIMC = "DesnutriciÃ³n Moderada";
  } else if (imc >= 17 && imc < 18.5) {
    clasificacionIMC = "DesnutriciÃ³n Leve";
  } else if (imc >= 18.5 && imc < 25) {
    clasificacionIMC = "Normopeso";
  } else if (imc >= 25 && imc < 30) {
    clasificacionIMC = "Sobrepeso";
  } else if (imc >= 30 && imc < 35) {
    clasificacionIMC = "Obesidad Grado I";
  } else if (imc >= 35 && imc < 40) {
    clasificacionIMC = "Obesidad Grado II";
  } else {
    clasificacionIMC = "Obesidad Grado III";
  }

  // FÃ³rmula de Harris-Benedict
  let tmbHB = 0;
  if (sexo === "Femenino") {
    tmbHB = 655.1 + (9.56 * peso) + (1.85 * talla) - (4.68 * edad);
  } else {
    tmbHB = 66.47 + (13.75 * peso) + (5 * talla) - (6.76 * edad);
  }
  const gctHB = tmbHB * factorPatologia * factorActividad;

  // MÃ©todo OMS
  let tmbOMS = 0;
  if (sexo === "Femenino") {
    if (edad < 30) tmbOMS = 14.7 * peso + 496;
    else if (edad < 60) tmbOMS = 8.7 * peso + 829;
    else tmbOMS = 10.5 * peso + 487;
  } else {
    if (edad < 30) tmbOMS = 15.3 * peso + 679;
    else if (edad < 60) tmbOMS = 11.5 * peso + 879;
    else tmbOMS = 13.5 * peso + 487;
  }
  const gctOMS = tmbOMS * factorPatologia * factorActividad;

    // MÃ©todo del Pulgar - segÃºn clasificaciÃ³n nutricional
  let factorPulgar = 25; // valor por defecto si no entra en ninguno de los casos

  if (clasificacionIMC.includes("DesnutriciÃ³n") || clasificacionIMC === "Bajo peso") {
    factorPulgar = 35; // usamos 30-35 como media
  } else if (clasificacionIMC === "Normopeso") {
    factorPulgar = 27.5; // media entre 25-30
  } else if (clasificacionIMC.startsWith("Obesidad")) {
    factorPulgar = 12.5; // media entre 10-15
  } else if (clasificacionIMC === "Sobrepeso") {
    factorPulgar = 20;
  }

  const kcalPulgar = peso * factorPulgar;


  // Mostrar resultados DE REQUERIMIENTOS


  const resultadoHTML = `

    <p><strong>IMC:</strong> ${imc.toFixed(1)} â€” <strong>${clasificacionIMC}</strong> <span style="font-size: 0.8em; color: #999;">(OMS, Canicoba y Mauricio 2017)</span></p>
  <hr style="margin: 12px 0;">
  <strong>
    <h3 style="color:#4285f4;">FÃ³rmula de Harris-Benedict</h3>
    <p><strong>TMB:</strong> ${tmbHB.toFixed(2)} kcal/dÃ­a</p>
    <p><strong>GCT:</strong> ${gctHB.toFixed(2)} kcal/dÃ­a</p>
    <p><strong>kcal/kg:</strong> ${(gctHB / peso).toFixed(2)} kcal/kg</p>

    <h3 style="color:#388e3c;">FÃ³rmula OMS</h3>
    <p><strong>TMB:</strong> ${tmbOMS.toFixed(2)} kcal/dÃ­a</p>
    <p><strong>GCT:</strong> ${gctOMS.toFixed(2)} kcal/dÃ­a</p>
    <p><strong>kcal/kg:</strong> ${(gctOMS / peso).toFixed(2)} kcal/kg</p>

      <h3 style="color:#d84315;">MÃ©todo del Pulgar</h3>
  <p><strong>Factor aplicado:</strong> ${factorPulgar} kcal/kg/dÃ­a</p>
  <p><strong>EstimaciÃ³n rÃ¡pida:</strong> ${kcalPulgar.toFixed(2)} kcal/dÃ­a</p>
`;


//INSERTAS LOS RESULTADOS DE TMB Y GCT:

  document.getElementById("resultado").innerHTML = resultadoHTML;
  document.getElementById("resultado").style.display = "block";
}


// ESTO ES NUEVO NO ESTA EN APP SCRIP  para registrar el service worker:
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/service-worker.js')
      .then(reg => console.log('Service Worker registrado', reg))
      .catch(err => console.log('Error registrando Service Worker', err));
  });
}

  </script>
    <!-- BotÃ³n para instalar la app, oculto por defecto -->
<button id="btn-install" style="display:none;">Instalar app</button>

    
    <script>
  let deferredPrompt;

  window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;

    const btnInstall = document.getElementById('btn-install');
    btnInstall.style.display = 'block';

    btnInstall.addEventListener('click', () => {
      btnInstall.style.display = 'none';
      deferredPrompt.prompt();
      deferredPrompt.userChoice.then((choiceResult) => {
        deferredPrompt = null;
      });
    });
  });
    </script>
  </body>
</html>

